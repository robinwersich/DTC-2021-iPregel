---
title: "DTC 2021 - Analysis Pagerank vs. h-index"
output: html_notebook
---

## Load Measure and Classical Score Data

```{r}

pagerank.normalized <- as.data.frame(read.csv("../results/networkit_pagerank_author-citation.txt", sep="\t", header=FALSE))
colnames(pagerank.normalized) <- c("ID", "PageRank")

h_index = as.data.frame(read.csv("../results/author-metadata.txt", sep="\t"))
h_index.normalized <- h_index
h_index.sum <- sum(h_index["h.index"])
h_index.normalized["h.index"] <- apply(h_index.normalized["h.index"], 2, function(x) {x / h_index.sum})
```

## 1.Is the alternative node importance measure feasible?

### a. Computationally: Run-Time Complexity, Resource consumption

- extract from Benchmarking Results
- PageRank fast calculation (max 10s on our biggest data set (1,6 million nodes, 171 million edges ))
- Resource consumption was ok 

### b. Semantic / Interpretation-Wise:

#### Do (all) vertices receive a meaningful score? (How does this compare to the classical measure?)

1. Compare Range and Number of Zero-Values.

```{r}
pagerank.range <- range(pagerank.normalized$PageRank)

```

Every vertex did get assigned a value different from 0 for PageRank.

2. Compare Mean / Median. 

```{r}
pagerank.mean <- mean(pagerank.normalized$PageRank)
pagerank.median <- median(pagerank.normalized$PageRank)
```

3. Have a look at value dist. among quartiles.

```{r}
summary(pagerank.normalized$PageRank)
```

#### What is the distribution? How well does the measure distinguish vertices?

```{r}
pagerank.max <- max(pagerank.normalized$PageRank)
hist(pagerank.normalized$PageRank, breaks = 100, xlim=range(0,pagerank.max))
hist(pagerank.normalized$PageRank, breaks = 100, xlim=range(0,0.001))

```
```{r}
summary(pagerank.normalized$PageRank)
boxplot(pagerank.normalized$PageRank)
```

#### Is there a meaningful interpretation for the scores?
- You get credit if someone with a lot of credit cites you.

=> Feasible Score

## 2. How (much) does the alternative measure differ from the classical measure? Regarding Selectivity, Vertices assigned as most important, and score per vertex (are there a lot of fluctuation and/or trends)?

### a. Assignment of meaningful scores to vertices

1. Compare Range and Number of Zero-Values.

```{r}
pagerank.range <- range(pagerank.normalized$PageRank)
h_index.range <- range(h_index$h.index)
h_index.zero_count <- colSums(h_index == 0)
vertex_count <- nrow(h_index)

```

Every vertex did get assigned a value different from 0 for PageRank. 1576 / 8729 ~ 18 % of vertices / scientists did get an h-index of 0. 

2. Compare Mean / Median. 

```{r}
pagerank.mean <- mean(pagerank.normalized$PageRank)
pagerank.median <- median(pagerank.normalized$PageRank)

h_index.mean <- mean(h_index$h.index)
h_index.median <- median(h_index$h.index)
```

3. Have a look at value dist. among quartiles.

```{r}
summary(pagerank.normalized$PageRank)
summary(h_index$h.index)
```

-> 75% of scientists have a maximum h-index of 3 
### b. Distribution of scores (Boxplot, Violinplot, Histogram)

```{r}
h_index.max <- max(h_index$h.index)
hist(h_index$h.index, breaks = 100, xlim=range(0, h_index.max))

h_index.normalized.max <- max(h_index.normalized$h.index)
hist(h_index.normalized$h.index, breaks = 100, xlim=range(0, h_index.normalized.max))
```

```{r}
library(ggplot2)

pagerank.combinable <- pagerank.normalized
colnames(pagerank.combinable) <- c("ID", "Score")
pagerank.combinable$Type <- 'PageRank'
h_index.combinable <- h_index.normalized[,c(1,3)]
colnames(h_index.combinable) <- c("ID", "Score")
h_index.combinable$Type <- 'H-Index'
data.combined <- rbind(pagerank.combinable,h_index.combinable)
data.combined$Type <- as.factor(data.combined$Type)
# Basic violin plot
p <- ggplot(data=data.combined, aes(x=Type, y=Score)) + 
  geom_violin()
p
```


### b. Top vertices (what are they, overlaps, characterize them further?)

1. What are the top vertices?

```{r}
library(dplyr)
top.vertices.pageRank <- top_n(pagerank.normalized, 20)
top.vertices.pageRank <- top.vertices.pageRank[order(top.vertices.pageRank$PageRank, decreasing = TRUE),]
```
```{r}
top.vertices.h_index <- top_n(h_index, 20)
top.vertices.h_index <- top.vertices.h_index[order(top.vertices.h_index$h.index, decreasing = TRUE),]
```


2. What is the overlap? Is there overlap?
```{r}
top.vertices.combined <- cbind(top.vertices.h_index, top.vertices.pageRank)
top.vertices.overlap <- intersect(top.vertices.h_index$ID, top.vertices.pageRank$ID)
```

```{r}
data.combined <- cbind(pagerank.normalized, h_index)
data.combined
```
3. How correlated are they?

```{r}
plot(top.vertices.h_index$h.index, top.vertices.pageRank$PageRank)
```
```{r}
top.vertices.cor.r <- cor(top.vertices.h_index$h.index, top.vertices.pageRank$PageRank)
top.vertices.cor.r2 <- top.vertices.cor.r ^ 2
```


### c. Difference per vertex (Distribution, 2D Plot plot importance against each other (smooth scatter), marginal distribution, Pearson / Spearman Correlation ?)

1. Difference per vertex?

2. Plot Scores against each other
```{r}
plot(pagerank.normalized$PageRank, h_index$h.index)
```

3a. Pearson Correlation
```{r}
cor.r <- cor(h_index$h.index, pagerank.normalized$PageRank)
cor.r2 <- cor.r ^ 2
```

3b. Spearman Correlation

```{r}
spearman.cor.r <- cor(h_index$h.index, pagerank.normalized$PageRank, method="spearman")
spearman.cor.r2 <- spearman.cor.r ^ 2
```

### d. Visualize network with node importance scores.

1. Load network as edgelist
```{r}

network.edgelist <- as.matrix(read.csv("../data_prepared/author-citation.txt", sep="\t", header=FALSE))

# make vertices 1-indexed so igraph can handle them
network.edgelist[,1] <- network.edgelist[,1] + 1
network.edgelist[,2] <- network.edgelist[,2] + 1
```

```{r}
library(igraph)
graph <- graph_from_edgelist(network.edgelist, directed = TRUE)
summary(graph)
```

```{r}
top.vertices.pageRank.subNetwork <- network.edgelist[network.edgelist[,1] %in% top.vertices.pageRank$ID, ]
```




#### Interesting observations:

- 1:
1456 2.114524e-05 1456 V. Slobodenyuk 3
has an h-index in upper-quartile but lowest possible h-index score => what are his cites like? 
assumption: only not important people cited him? possibly only within one group, self-citations etc?

```{r}
library(igraph)

v.slob.subNetwork <- rbind(network.edgelist[network.edgelist[,1] == 1456, ], network.edgelist[network.edgelist[,2] == 1456, ])

v.slob.graph <- graph_from_edgelist(v.slob.subNetwork, directed = TRUE)
plot(v.slob.graph)
```


#### Fazit:

- Pagerank and H-Index high correlation
- Pagerank differentiates / seperates more strongly 
- Example of V. Slobodenyuk -> trend to the better? Lower impact of unimportant citations / self-citations etc?



